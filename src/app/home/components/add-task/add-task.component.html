<main>
  <section>
    <h1>Add Task</h1>

    <form
      [formGroup]="addTaskForm"
      (ngSubmit)="addTask()"
      (reset)="resetAddTaskForm()"
      class="add-task-form"
    >
      <div>
        <div class="input-box">
          <label for="title">Title</label>
          <input
            placeholder="Enter a title"
            required
            type="text"
            id="title"
            formControlName="title"
          />
        </div>

        <div class="input-box">
          <label for="description">Description</label>
          <textarea
            placeholder="Enter a Description"
            id="description"
            cols="30"
            rows="10"
            formControlName="description"
          ></textarea>
        </div>

        <div id="category-box" class="input-box">
          <span class="label">Category</span>

          @if (createCategoryOpen) {
          <div id="category" [style.padding]="0">
            <input
              placeholder="New category name"
              id="category-input"
              type="text"
              formControlName="newCategoryInput"
            />
            <div class="add-category-img-box">
              <img
                (click)="closeCreateCategory()"
                class="subtask-img"
                src="./assets/img/icons/cancel-icon.svg"
                alt=""
              />
              <div class="seperator-small"></div>
              <img
                (click)="addNewCategory()"
                class="subtask-img"
                src="./assets/img/icons/checkmark-icon-black.svg"
                alt=""
              />
            </div>
          </div>
          <div id="color-picker-box">
            @for (color of categoryColors; track $index) {
            <div
              [ngClass]="{ 'active-color': color === selectedColor }"
              (click)="selectColor(color)"
              class="color-picker-color"
              [style.background-color]="color"
            ></div>
            }
          </div>
          }@else {
          <div id="category">
            @if (!selectedCategory) {
            <div (click)="toggleCategoryPicker()">
              <span>Select task category</span>
              <img
                class="open-arrow"
                src="../assets/img/icons/open-select-arrow.svg"
                alt="arrow-down"
              />
            </div>
            }@else {
            <div (click)="toggleCategoryPicker()">
              <div>
                <span>{{ selectedCategory.name }}</span>
                <div
                  class="color-picker-color"
                  [style.background-color]="selectedCategory.color"
                ></div>
              </div>

              <img
                class="open-arrow"
                src="../assets/img/icons/open-select-arrow.svg"
                alt="arrow-down"
              />
            </div>
            } @if (selectCategoryOpen) {

            <div (click)="openCreateCategory()">
              <span>New category</span>
            </div>

            @for (category of categorys; track $index) {
            <div (click)="setCategory(category)">
              <div>
                <span>{{ category.name }}</span>
                <div
                  class="color-picker-color"
                  [style.background-color]="category.color"
                ></div>
              </div>
            </div>
            }}
          </div>
          }

          <div id="errorTagCategory" class="error-msg-task d-none">
            Please select a category or create a new one
          </div>
        </div>

        <div id="add-task-assigned-to-box" class="input-box">
          <span class="label">Assigned to</span>
          <div onclick="toggleUserPicker()" id="assigned-to">
            <div>
              <span>Select contacts to assign</span>
              <img
                class="open-arrow"
                src="./assets/img/icons/open-select-arrow.svg"
                alt="arrow-down"
              />
            </div>
          </div>
          <div id="errorTagAssign" class="error-msg-task d-none">
            Please assign the task to at least one person
          </div>
        </div>
      </div>

      <div class="seperator"></div>

      <div class="form-right-box">
        <div class="form-right-top-box">
          <div class="input-box">
            <label for="due-date">Due date</label>
            <input
              required
              onclick="setMinDate()"
              type="date"
              id="due-date"
              formControlName="date"
            />
          </div>

          <div id="prio-box-wrapper" class="input-box">
            <span>Prio</span>
            <div id="prio-box">
              <div id="high-prio-box" onclick="setPrio('high')">
                <span>Urgent</span>
                <img
                  src="./assets/img/icons/high-prio-icon-small.svg"
                  alt="high-prio"
                />
              </div>
              <div id="medium-prio-box" onclick="setPrio('medium')">
                <span>Medium</span>
                <img
                  src="./assets/img/icons/medium-prio-icon-small.svg"
                  alt="medium-prio"
                />
              </div>
              <div id="low-prio-box" onclick="setPrio('low')">
                <span>Low</span>
                <img
                  src="./assets/img/icons/low-prio-icon-small.svg"
                  alt="low-prio"
                />
              </div>
            </div>
            <div id="errorTagPrio" class="error-msg-task d-none">
              Please select a priority
            </div>
          </div>

          <div id="subtask-box-wrapper" class="input-box">
            <label for="subtask-input">Subtasks</label>
            <div class="input-with-icons">
              <input
                placeholder="Add new subtask"
                id="subtask-input"
                type="text"
                name="subtask-input"
              />
              <div class="input-icon-box">
                <img
                  onclick="clearInput('subtask-input')"
                  class="subtask-img"
                  src="../assets/img/icons/cancel-icon.svg"
                  alt=""
                />
                <div class="seperator-small"></div>
                <img
                  onclick="addSubtask()"
                  class="subtask-img"
                  src="../assets/img/icons/checkmark-icon-black.svg"
                  alt=""
                />
              </div>
            </div>
          </div>
          <div id="subtask-box"></div>
        </div>
        <div class="form-right-bottom-box">
          <div class="button-box">
            <app-button-with-icon
              [content]="'Clear'"
              [colorStyle]="'secondary-color-style'"
              [imgSrc]="'./assets/img/icons/cancel-icon.svg'"
              [type]="'reset'"
            ></app-button-with-icon>
            <app-button-with-icon
              [content]="'Create Task'"
              [colorStyle]="'main-color-style'"
              [imgSrc]="'./assets/img/icons/checkmark-icon.svg'"
              [type]="'submit'"
            ></app-button-with-icon>
          </div>
        </div>
      </div>
      <input type="submit" id="submit-form" class="d-none" />
    </form>
  </section>
</main>
